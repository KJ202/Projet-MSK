%% ParamÃ¨tres initiaux
nbSymbols= 10  ; % NB de symboles Ã  transmettre


nsamp = 32 ; %nombre d'échantillons pour un bit dans le channel I et Q. Dans chaque channel, un bit sera codé sur 2*nsamp échantillons
symbols = randi([0 1],nbSymbols,1);


%% Modulation
% GÃ©nÃ©ration d'un sinus et ajout d'un bruit blanc Gaussien

fp = 100;      % frÃ©quence de la porteuse 
fm = 20;       % nombre de bit par secondes par channel
fe = 1000;      % FrÃ©quence des échantillons: On a 1000 echantillons par secondes
N = (var/2)*(fe/fm);       % Nombre d'échantillons dans chaque voie

% Axe des temps
t = (1:N)/fe;

% Génération des cosinus et sinus surrélevés
rootRaised = mskmod(symbols,fe/fm/2,[],pi/2);

% GÃ©nÃ©ration du sinus pour les coeffs

sinPorteuse = sin(2*pi* fp *t);
cosPorteuse = cos(2*pi* fp *t);

partI = sinPorteuse .* imag(rootRaised)' ;   % multiplication element par element
partQ = cosPorteuse .* real(rootRaised)' ;

signal = partI + partQ ;
%s=awgn(signal,10);
%% DÃ©modulation

demodI = signal .* sinPorteuse ;
demodQ = signal .* cosPorteuse ;

b = [1/10 1/10 1/10 1/10 1/10 1/10 1/10 1/10 1/10 1/10];
resI = filter(b,1,demodI);
resQ = filter(b,1,demodQ);

resSum = resQ + j*resI ;
%z = mskdemod(resSum,nsamp,[],pi/2);

%% FFT

spectre = abs(fft(cosPorteuse));

%% Plot

subplot(421);
plot(t2,symbols,'bs');
xlabel('Symboles : bits input')

subplot(424);
plot(t, cosPorteuse);
xlabel('cosPorteuse')

subplot(422);
plot(t, real(rootRaised));
xlabel('Partie réelle : coeff ak ?')

subplot(423);
plot(t, partQ);
xlabel('partie Q modulÃ©e')

subplot(425);
plot(t, signal);
xlabel('Signal modulÃ©')


L = N ;
f = fe*(0:(L/2))/L;
fft1Signal = abs(fft(cosPorteuse));
fft2Signal = fft1Signal(1:L/2+1);

fft1PartQ = abs(fft(partQ));
fft2PartQ = fft1Signal(1:L/2+1);

subplot(426);
plot(f,fft2PartQ);
xlabel('fft de partQ')

subplot(427);
plot(f,fft2Signal);
xlabel('fft du signal modulé')

subplot(428);
plot(z,'bs');
xlabel('Symboles reçus')

